pipeline {
  agent { docker { image 'maven:3.9-eclipse-temurin-17' } }
  options { skipDefaultCheckout(); timestamps() }

  stages {
    stage('Checkout') {
      steps {
        git url: 'https://github.com/Elvis-Ikay/Number-Guess-Game-Group2.git',
            branch: 'group2-subomi'
      }
    }

    // Run tests and build in one go (tests once)
    stage('Build & Test') {
      steps {
        sh 'mvn -B -q -U clean verify'   // compiles + runs tests + builds
      }
      post {
        always {
          junit '**/target/surefire-reports/*.xml'  // show test results in Jenkins
        }
      }
    }

    stage('Archive Artifact') {
      steps {
        // archive WAR or JAR (adjust if your pom produces only one)
        archiveArtifacts artifacts: 'target/*.war, target/*.jar', fingerprint: true, onlyIfSuccessful: true
      }
    }
  }

  post {
    success { echo 'Build and tests completed successfully!' }
    failure { echo 'Build failed. Open Console Output for details.' }
  }
}
